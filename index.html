<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monumental Kazakhstan</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
    <style>
        * { box-sizing: border-box; }
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            overflow: hidden;
        }
        #map { height: 100vh; width: 100vw; background-color: #f0f0f0; }
        
        #loading-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.9); display: flex; align-items: center;
            justify-content: center; z-index: 4000; flex-direction: column; padding: 20px;
        }
        .loading-spinner {
            width: 40px; height: 40px; border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff; border-radius: 50%;
            animation: spin 1s linear infinite; margin-bottom: 10px;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        
        .map-layer-control {
            position: absolute; top: 10px; right: 10px; z-index: 1000;
            background: white; border-radius: 6px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); overflow: hidden;
        }
        .layer-button {
            padding: 10px 15px; border: none; background: white; cursor: pointer;
            font-size: 13px; border-bottom: 1px solid #eee; display: block; width: 100%;
        }
        .layer-button:last-child { border-bottom: none; }
        .layer-button:hover { background: #f5f5f5; }
        .layer-button.active { background: #007bff; color: white; }
        
        .popup-title { font-weight: bold; margin-bottom: 8px; font-size: 16px; }
        .popup-content { font-size: 14px; line-height: 1.5; margin-bottom: 10px; max-height: 150px; overflow-y: auto; }
        .popup-content b { font-weight: 600; }
        .coordinates-footer { display: flex; align-items: center; justify-content: space-between; gap: 8px; width: 100%; margin-top: 12px; }
        .coordinates-box { background: #f3f4f6; color: #333; padding: 6px 10px; border-radius: 4px; font-family: monospace; font-size: 13px; cursor: copy; position: relative; }
        .copy-confirm { position: absolute; left:0; right: 0; top: 0; bottom: 0; display: flex; align-items: center; justify-content: center; background: #28a745; color: white; opacity: 0; transition: opacity 0.3s; }
        .coordinates-box.copied .copy-confirm { opacity: 1; }
        .map-service-buttons { display: flex; gap: 4px; }
        .map-btn, .share-btn { background: #e9ecef; border: none; cursor: pointer; padding: 6px; border-radius: 4px; display: flex; align-items: center; justify-content: center; }
        .map-btn:hover, .share-btn:hover { background: #dee2e6; }
        .map-icon, .share-icon { width: 20px; height: 20px; display: block; }
        
        #filter-container {
            position: absolute; top: 10px; left: 10px; z-index: 2000;
            background: white; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            width: 320px; max-height: calc(100vh - 20px); display: flex;
            flex-direction: column; transition: transform 0.3s ease-in-out;
        }
        #filter-container.collapsed { transform: translateX(-100%); left: -10px; }
        .filter-toggle {
            position: absolute; left: 100%; top: 10px; background: white; border: none; width: 40px; height: 40px;
            border-radius: 0 8px 8px 0; box-shadow: 5px 0 15px rgba(0,0,0,0.15); cursor: pointer; display: flex;
            align-items: center; justify-content: center; font-size: 20px; z-index: -1;
        }
        
        .filter-panel-header { padding: 15px; border-bottom: 1px solid #eee; position: relative; }
        .filter-panel-header h3 { margin: 0 0 10px 0; font-size: 18px; }
        #search-input { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ddd; font-size: 14px; }
        #results-container { font-size: 13px; color: #666; margin-top: 10px; min-height: 18px; display: flex; align-items: center; gap: 8px; }
        .filter-loading { display: none; width: 16px; height: 16px; border: 2px solid #f3f3f3; border-top: 2px solid #007bff; border-radius: 50%; animation: spin 0.8s linear infinite; }
        
        .filter-controls { overflow-y: auto; padding: 15px; flex-grow: 1; }
        
        /* NEW: Search Results List */
        #search-results-list {
            max-height: 250px;
            overflow-y: auto;
            border-top: 1px solid #eee;
        }
        .search-result-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f5f5f5;
            transition: background-color 0.2s;
        }
        .search-result-item:hover { background-color: #f8f9fa; }
        .search-result-item .title { font-weight: 600; }
        .search-result-item .city { font-size: 12px; color: #6c757d; }

        .filter-group { margin-bottom: 20px; }
        .filter-group-label { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; font-size: 14px; font-weight: 600; }
        .filter-count { background: #e9ecef; color: #333; font-size: 11px; padding: 2px 6px; border-radius: 10px; }
        
        .checkbox-container { max-height: 150px; overflow-y: auto; border: 1px solid #e1e5e9; border-radius: 6px; padding: 10px; background: #f8f9fa; }
        .checkbox-item label { font-size: 14px; display: flex; align-items: center; cursor: pointer; padding: 4px; border-radius: 4px; transition: background-color 0.2s; }
        .checkbox-item label:hover { background: #e9ecef; }
        .checkbox-item input { margin-right: 10px; }
        
        .year-filter-container { display: flex; gap: 10px; }
        .year-filter-container input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; }
        
        .filter-panel-footer { padding: 15px; border-top: 1px solid #eee; }
        .clear-filters-btn { background: #6c757d; color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer; font-size: 14px; width: 100%; transition: background-color 0.2s; }
        .clear-filters-btn:hover { background: #5a6268; }
        
        #empty-state { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #666; z-index: 1500; display: none; }
        .empty-state-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.5; }
    </style>
</head>
<body>
    <div id="loading-overlay">
        <div class="loading-spinner"></div>
        <p>Loading monuments...</p>
    </div>

    <div id="map"></div>
    <div id="empty-state">
        <div class="empty-state-icon">üèõÔ∏è</div>
        <h3>No monuments found</h3>
        <p>Try adjusting your filters or search terms</p>
    </div>

    <div id="filter-container">
        <button class="filter-toggle" onclick="Filters.togglePanel()">√ó</button>
        <div class="filter-panel-header">
            <h3>Filters</h3>
            <input type="text" id="search-input" placeholder="Search monuments, artists, cities...">
            <div id="results-container">
                <span id="results-text"></span>
                <div class="filter-loading"></div>
            </div>
        </div>
        <!-- Search results list will be injected here by JS -->
        <div id="search-results-list"></div>
        <div class="filter-controls"></div>
        <div class="filter-panel-footer">
            <button onclick="Filters.clearAll()" class="clear-filters-btn">Clear All Filters</button>
        </div>
    </div>

    <div class="map-layer-control"></div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    
    <svg style="display:none;">
        <symbol id="google-maps-icon" viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></symbol>
        <symbol id="yandex-icon" viewBox="0 0 24 24"><path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm.042 18.18c-3.403 0-5.825-1.44-5.825-4.14V5.82h2.405v8.16c0 1.32.842 2.16 3.42 2.16 2.562 0 3.42-.84 3.42-2.16V5.82h2.404v8.22c0 2.7-2.422 4.14-5.824 4.14z"/></symbol>
        <symbol id="2gis-icon" viewBox="0 0 24 24"><path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm0 19.5a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15z"/></symbol>
        <symbol id="share-icon" viewBox="0 0 24 24"><path d="M18 16c-.8 0-1.5.3-2 .8l-7-4.2c0-.2.1-.4.1-.6s0-.4-.1-.6l7-4.2c.5.5 1.2.8 2 .8 1.7 0 3-1.3 3-3s-1.3-3-3-3-3 1.3-3 3c0 .2.1.4.1.6l-7 4.2c-.5-.5-1.2-.8-2-.8-1.7 0-3 1.3-3 3s1.3 3 3 3c.8 0 1.5-.3 2-.8l7 4.2c0 .2-.1.4-.1.6 0 1.7 1.3 3 3 3s3-1.3 3-3-1.3-3-3-3z"/></symbol>
    </svg>

    <script src="map-layers.js"></script>
    <script src="filters.js"></script>
    <script src="app.js"></script>
</body>
</html>